<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Visitante - Gerenciamento de Itens</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="stylesheet" href="/assets/css/dashboard.css">
</head>
<body>
  <div class="d-flex">
    <aside class="kiwi-sidebar bg-primary text-white d-flex flex-column p-3" style="width:220px;min-height:100vh;position:fixed;top:0;left:0;z-index:100;">
      <h4 class="mb-4"><i class="fa fa-lemon"></i> Visitante</h4>
      <nav class="flex-grow-1">
        <a href="#" class="d-block mb-2 text-white"><i class="fa fa-home"></i> Dashboard</a>
        <a href="#" class="d-block mb-2 text-white"><i class="fa fa-list"></i> Itens</a>
      </nav>
      <div class="mt-auto d-flex flex-column gap-2">
        <a href="/page/usuario/login.html" class="btn btn-light btn-sm w-100 mb-1">Login</a>
        <a href="/page/usuario/registrar.html" class="btn btn-outline-light btn-sm w-100">Registrar</a>
      </div>
    </aside>
    <main class="flex-grow-1 p-4" style="background:linear-gradient(135deg,#6a11cb,#2575fc);min-height:100vh;margin-left:220px;">
      <div class="container-fluid">
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card text-center shadow-sm">
              <div class="card-body p-2">
                <canvas id="graficoMini1" width="80" height="80"></canvas>
                <div class="small text-white mt-2"><span style="color:#000000;">Itens/Categoria</span></div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center shadow-sm">
              <div class="card-body p-2">
                <canvas id="graficoMini2" width="80" height="80"></canvas>
                <div class="small text-white mt-2"><span style="color:#000000;">Qtd/Categoria</span></div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center shadow-sm">
              <div class="card-body p-2">
                <canvas id="graficoMini3" width="80" height="80"></canvas>
                <div class="small text-white mt-2"><span style="color:#000000;">Itens/Dia</span></div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card text-center shadow-sm">
              <div class="card-body p-2">
                <canvas id="graficoMini4" width="80" height="80"></canvas>
                <div class="small text-white mt-2"><span style="color:#000000;">% Categorias</span></div>
              </div>
            </div>
          </div>
        </div>
        <div class="row mb-4 align-items-center">
          <div class="col-md-9">
            <!-- Botões removidos para visitantes -->
          </div>
          <div class="col-md-3">
            <input type="text" class="form-control" id="barraPesquisa" placeholder="Pesquisar itens...">
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="card shadow-sm">
              <div class="card-header bg-primary text-white">
                Itens Salvos
              </div>
              <div class="card-body" id="itensBanco">
                <span class="text-muted">Carregando itens...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
// Função para carregar os 4 gráficos minimalistas
async function carregarMiniGraficos() {
  try {
    const response = await fetch('http://localhost:3000/api/itens/categorias');
    const dados = await response.json();
    const labels = ['Ds', 'Administração', 'Qui'];
    const values = [dados.ds||0, dados.administracao||0, dados.qui||0];
    const cores = ['#FF6384', '#36A2EB', '#FFCE56'];
    // Gráfico 1: Itens/Categoria
    new Chart(document.getElementById('graficoMini1').getContext('2d'), {
      type: 'doughnut',
      data: { labels, datasets: [{ data: values, backgroundColor: cores }] },
      options: { plugins: { legend: { display: false } }, cutout: '70%' }
    });
    // Gráfico 2: Qtd/Categoria
    new Chart(document.getElementById('graficoMini2').getContext('2d'), {
      type: 'bar',
      data: { labels, datasets: [{ data: values, backgroundColor: cores }] },
      options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });
    // Gráfico 3: Itens/Dia (mock)
    new Chart(document.getElementById('graficoMini3').getContext('2d'), {
      type: 'line',
      data: { labels: ['Seg', 'Ter', 'Qua'], datasets: [{ data: [2,4,3], borderColor: '#36A2EB', fill: false }] },
      options: { plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { display: false } } }
    });
    // Gráfico 4: % Categorias
    const total = values.reduce((a,b)=>a+b,0);
    new Chart(document.getElementById('graficoMini4').getContext('2d'), {
      type: 'pie',
      data: { labels, datasets: [{ data: values.map(v=>total?((v/total)*100).toFixed(1):0), backgroundColor: cores }] },
      options: { plugins: { legend: { display: false } } }
    });
  } catch {}
}
// Função para filtrar itens pela barra de pesquisa
document.getElementById('barraPesquisa').addEventListener('input', function() {
  const termo = this.value.toLowerCase();
  const lista = document.getElementById('itensBanco');
  Array.from(lista.children).forEach(item => {
    if (item.textContent.toLowerCase().includes(termo)) {
      item.style.display = '';
    } else {
      item.style.display = 'none';
    }
  });
});
async function carregarItens() {
  const lista = document.getElementById('itensBanco');
  lista.innerHTML = '<span class="text-muted">Carregando itens...</span>';
  try {
    const response = await fetch('http://localhost:3000/api/itens');
    const itens = await response.json();
    if (!Array.isArray(itens) || itens.length === 0) {
      lista.innerHTML = '<span class="text-muted">Nenhum item cadastrado.</span>';
      return;
    }
    lista.innerHTML = '';
    itens.forEach(item => {
      const div = document.createElement('div');
      div.className = "card mb-2 shadow-sm";
      div.innerHTML = `
        <div class="card-body">
          <h6 class="card-title">${item.nome}</h6>
          <p class="card-text"><strong>Quantidade:</strong> ${item.quantidade}</p>
          <p class="card-text"><strong>Descrição:</strong> ${item.descricao}</p>
        </div>
      `;
      lista.appendChild(div);
    });
  } catch (error) {
    lista.innerHTML = '<span class="text-danger">Erro ao carregar itens.</span>';
  }
}
window.addEventListener('DOMContentLoaded', () => {
  carregarItens();
  carregarMiniGraficos();
});
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
